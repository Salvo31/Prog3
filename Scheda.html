<html>

<head>
<meta charset="utf-8">
<link rel="stylesheet" href="Css/cssTemporanei.css">
<title> Scheda </title>
</head>

<body>

  <div id="descrizione">
    <h2> <strong> Scheda </strong> </h2> <br>
    Con questa opzione potrai generare una classica scheda di allenamento con serie e ripetizioni ben definite <br>
    Proprio come quelle che si utilizzano in sala attrezzi! Con la differenza che qui ti dovrai affidare al caso...
  </div> <br> <br>

  <div id="displayEsercizi">  </div> <br>
  <!-- <div id="pannelloWorkout"> </div> <br> -->
  <button id="request"> Request workout </div>
  <button id="start"> Start workout </button>
  <button id="stop"> Stop workout </button> <br>

  <div id="opzioniAllenamento">
  <!--  Vuoi selezionare un focus di gruppi muscolari per l'allenamento di oggi?
    <input type="checkbox" id="checkGruppi"> <br>

    <div id="selezioneGruppi" class="invisibles">
      <div id="gruppi">

      </div>
    </div> -->
    <div id="tipoEsercizi">
      Disponi di manubri/pesi?
      <input type="checkbox" id="pesiSiNo">
    </div>
    <script src="ExternalJs/listaGruppi.js"> </script> <!-- In questo tag è inserito il codice che definisce l'oggetto per la lista dei gruppi -->
  </div>
  <script src="https://e-cdn-files.dzcdn.net/js/min/dz.js"></script> <!-- File col player di DEEZER -->
  <div id="dz-root"> </div> <!-- Div richiesto dalle API di DEEZER -->
  <div id="player"> </div>

  <script>

    window.onload = bindEvents;
    //richiestaGruppiMuscolari();
    //var placeholder = document.getElementById("gruppi");
    //var gruppiScelti = new listaGruppi();
    document.getElementById("player").style.display = "none";
    document.getElementById("stop").style.display = "none";
    DZ.init({
      appId  : '539622',
      channelUrl : 'http://developers.deezer.com/examples/channel.php', //Vedere quale tenere
      //channelUrl : 'http://localhost/Prog3/RandomWorkout/deezerChannel.html',
      player: {
        container: 'player',
        cover : true,
        layout : 'dark',
        width : 650,
        height : 300,
        onload : playerLoaded
      }
    });

    function playerLoaded(){
      DZ.player.playPlaylist(8424675842);
      DZ.player.setShuffle(true);
    }

    function bindEvents(){
      document.getElementById("start").disabled = true;
      document.getElementById("request").addEventListener("click",requestWorkout);
      //document.getElementById("checkGruppi").addEventListener("change",setGruppiMuscolari);
      document.getElementById("start").addEventListener("click",startWorkout);
      document.getElementById("stop").addEventListener("click",stopWorkout);
    }


    function stopWorkout(){
      document.getElementById("displayEsercizi").innerHTML = " ";
      document.getElementById("request").style.display = "block";
      document.getElementById("start").style.display = "block";
      document.getElementById("stop").style.display = "none";
      document.getElementById("tipoEsercizi").style.display = "block";
      document.getElementById("opzioniAllenamento").style.display = "block";
      DZ.player.pause();
    }

    function startWorkout(){
      DZ.player.next();
      DZ.player.play();
      document.getElementById("request").style.display = "none";
      document.getElementById("start").disabled = true;
      document.getElementById("opzioniAllenamento").style.display = "none";
      document.getElementById("player").style.display = "block";
      document.getElementById("start").style.display = 'none';
      document.getElementById("stop").style.display = "block";
      document.getElementById("tipoEsercizi").style.display = "none";
    }

    /*function verificaSelezione(){
      Modificare per scegliere se nell'oggetto bisogna memorizzare anche l'id
      del db o solo questo e poi sommare/sottrarre. Dal punto di vista computazionale
      var gruppoSelezionato = document.getElementById(event.srcElement.id);
      if(gruppoSelezionato.checked && gruppiScelti.count < 3){
        gruppiScelti.addElement(gruppoSelezionato.id);
      }
      else if(!gruppoSelezionato.checked){
        gruppiScelti.removeElement(gruppoSelezionato.id);
      }
      else{
        alert("Non puoi scegliere più di 3 gruppi muscolari!");
        gruppoSelezionato.checked = false;
        }
      gruppiScelti.printList();
    }

    function setGruppiMuscolari(){
      if(document.getElementById("checkGruppi").checked){
        document.getElementsByClassName("invisibles")[0].style.display = "block";
      }
      else if (!document.getElementById("checkGruppi").checked) {
        document.getElementsByClassName("invisibles")[0].style.display = "none";
        gruppiScelti.emptyList(); //Svuoto gli elementi selezionati
        var i = placeholder.getElementsByTagName("input").length;
        for(var j=0;j<i;j++)
        {
          if(document.getElementById(j).nodeName == "INPUT")
          {
            document.getElementById(j).checked = false;
          }
        }
      }
    }

    function generaLista(gruppi){
      for(var i=0;i<gruppi.length;i++){ //genero dinamicamente una serie di checkbox per i gruppi muscolari
        var checkbox = document.createElement("input");
        var label = document.createElement("label");
        var aCapo = document.createElement("br");
        label.for = i;
        label.innerHTML = gruppi[i].Nome;
        checkbox.type = "checkbox";
        checkbox.id = i;
        checkbox.value = gruppi[i].IdGruppoMuscolare;
        placeholder.appendChild(label);
        placeholder.appendChild(checkbox);
        placeholder.appendChild(aCapo);
        document.getElementById(i).addEventListener("change",verificaSelezione);
      }
    }

    function richiestaGruppiMuscolari(){
      var ajax = new XMLHttpRequest();
      ajax.onreadystatechange = function(){
        if(ajax.readyState == 4){
          var gruppi = JSON.parse(ajax.responseText);
          generaLista(gruppi);
        }
      };
      ajax.open("GET","apiDb.php/gruppomuscolare",true);
      ajax.send(null);
    } */

    function requestWorkout(){
      document.getElementById("start").disabled = false;
      document.getElementById("displayEsercizi").innerHTML = " ";
      var ajax = new XMLHttpRequest();
      var reqURI = "apiDb.php/SCHEDA/"+Number(document.getElementById("pesiSiNo").checked)+"/"+ Math.floor(Math.random() * (10 - 5+1) + 5);
      ajax.onreadystatechange = function(){
        if(ajax.readyState == 4){
          console.log(ajax.responseText);
          console.log(reqURI);
          var esercizi = JSON.parse(ajax.responseText);
          //document.getElementById("displayEsercizi").innerHTML = esercizi;
          displayWorkout(esercizi);
        }
      };
      ajax.open("GET",reqURI,true);
      ajax.send(null);
    }

    function displayWorkout(esercizi){
      var listaEsercizi = document.createElement("ul");
      listaEsercizi.id = "listaEsercizi";
      var numRep;
      var numSerie;
      for(var i=0;i<esercizi.length;i++){
        var Esercizio = document.createElement("li");
        numRep = Math.floor(Math.random() * (15 - 6+1) + 6);
        numSerie = Math.floor(Math.random() * (6 - 2+1)+2);
        Esercizio.innerHTML = "<b> <i> "+esercizi[i].Nome+" </i> </b> : "+ numSerie + " x " + numRep;
        listaEsercizi.appendChild(Esercizio);
      }
      document.getElementById("displayEsercizi").appendChild(listaEsercizi);
    }


  </script>
</body>

</html>
