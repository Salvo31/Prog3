<html>
<head>
  <title> Random Workout Generator </title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="Css/timer.css">
  <link rel="stylesheet" href="Css/customCSS.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <br>
      <ul class="navbar-nav">
        <li class="nav-item">
          <button id="personal" class="invisibles reservedAreaButton rounded-pill" data-bs-toggle="modal" data-bs-target="#loginModal"> Area riservata </button>
        </li>
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a href="paginaPersonale.html" class="invisibles myNav-link" id="linkProfilo"> </a>
        </li>
      </ul>
      <br>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="AMRAP.html">AMRAP</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="EMOM.html">EMOM</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="Scheda.html">Scheda</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="sostituzioniEsercizi.html"> Sostituzioni </a>
        </li>
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">
            <span data-bs-toggle="modal" data-bs-target="#tutorialModal">
              Tutorial
            </span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<div id="tutorialModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header loginModal-header">
        <h4 class="modal-title">Tutorial</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p> Benvenuto! <br>
          Se sei nuovo, ecco a te alcune indicazioni per poter incominciare ad usare al meglio
          questo generatore di workout! <br>
          Spero che gli allenamenti siano divertenti e che ti soddisfino! <br>
          <ul class="customListItem">
            <li class="customListItem"> Prima di poter iniziare qualsiasi workout è
            necessario generarlo mediante il pulsante "request workout" </li>
            <li class="customListItem"> Una volta che il workout è partito e successivamente messo in stop, non sarà più
            possibile riprenderlo </li>
            <li class="customListItem"> Per poter salvare i dati relativi al workout, è necessario
            essere prima loggati all'area riservata </li>
            <li class="customListItem"> Il link "Sostituzioni" porta alle propedeutiche possibili per alcuni esercizi </li>
          </ul>
        </p>
      </div>
    </div>
  </div>
</div>

<div id="alertSection">

</div>

  <!-- L'accesso all'area riservata permette di poter vedere gli allenamenti salvati
  <div id="DescrizionewWorkout">
    <ul id="ListaAllenamenti"> Probabilmente sarà a comparsa, inquanto in questa stessa pagina ci sarà il workout
      <li>
          <a href="AMRAP.html"> AMRAP </a>
      </li>
      <li>
          <a href="EMOM.html"> EMOM </a>
      </li>
      <li>
          <a href="Scheda.html"> Scheda </a>
      </li>
    </ul>
  </div> <br> <br> <!-- Fine Div che descrive i workout (Barra di navigazione fissa) -->

<script>
 var player;
 var schedaStartTime;
 var schedaEndTime;
 window.onload = bindEvents;
 TIME_LIMIT = 0; //dichiarazione iniziale e globale della variabile

 function bindEvents(){
   //document.getElementById("start").disabled = true;
   document.getElementById("start").addEventListener("click",startWorkout); //richiama lo start del timer nel momento in cui clicco sul bottone
   document.getElementById("stop").addEventListener("click",stopWorkout);
   document.getElementById("pause").addEventListener("click",pauseWorkout);
   //document.getElementById("tipoAllenamento").addEventListener("change",setWorkout);
   document.getElementById("tendinaMinuti").addEventListener("change",setMinuteOnTimer);
   document.getElementById("tipoAllenamento").addEventListener("change",timerVisibility);
   document.getElementById("request").addEventListener("click",requestWorkout);
   document.getElementById("fineAllenamento").addEventListener("workoutFinito",fineWorkout);
   document.getElementById("saveWorkout").addEventListener("click",saveWorkout);
   verifySession();
 }

 function timerVisibility(){
   if(tipoAll.value == "SCHEDA"){
     timer.style.display = "none";
     document.getElementById("selezioneMinuti").style.display = "none";
   }
   else if(timer.style.display == "none" && tipoAll.value != "SCHEDA"){
     timer.style.display = "block";
     document.getElementById("selezioneMinuti").style.display = "block";
   }
   document.getElementById("base-timer-label").innerHTML = formatTime(0);
   document.getElementById("start").disabled = true;
   onStopWorkout();
   setCircleDasharray();
 }

 function startWorkout(){
   document.getElementById("opzioniAllenamento").style.display = "none";
   document.getElementById("request").disabled= true;
   document.getElementById("start").disabled = true;
   document.getElementById("stop").disabled= false;
   document.getElementById("pause").disabled= false;
   document.getElementById("player").style.display = "block";
   document.getElementById("personal").style.display = "none";
   player.nextVideo();
   player.playVideo();
   if(tipoAll.value != "SCHEDA"){
        startTimer();
   }
   else{
        schedaStartTime = new Date();
   }

 }

 function pauseWorkout(){
   var resumeButton = document.getElementById("resume");
   player.pauseVideo();
   clearInterval(timerInterval);
   document.getElementById("base-timer-label").innerHTML = formatTime(timeLeft);
   resumeButton.disabled= false;
   resumeButton.addEventListener("click",resumeWorkout);
   document.getElementById("pause").disabled= true;
 }

 function resumeWorkout(){
   //DZ.player.play();
   player.playVideo();
   document.getElementById("pause").disabled= false;
   document.getElementById("resume").disabled= true;
   startTimer();
 }

 /*function setWorkout(){
   var workoutType = document.getElementById("tipoAllenamento").value;
   if(workoutType != "Random"){
     document.getElementById("pannelloWorkout").innerHTML = workoutType;
   }
   else{
     document.getElementById("pannelloWorkout").innerHTML = workoutType;
   }

 }*/

 function setMinuteOnTimer(){
   TIME_LIMIT = document.getElementById("tempo").value;
   if(TIME_LIMIT != 0){
     sessionStorage.setItem("durata",TIME_LIMIT); //MEMORIZZO LA DURATA DELL'ALLENAMENTO
     TIME_LIMIT = TIME_LIMIT * 60;
     document.getElementById("base-timer-label").innerHTML = formatTime(TIME_LIMIT) ;
   }
   else{
     var tempo = Math.floor(Math.random() * (60 - 10) + 10);
     sessionStorage.setItem("durata",tempo); //MEMORIZZO LA DURATA DELL'ALLENAMENTO
     TIME_LIMIT = tempo * 60;
     document.getElementById("base-timer-label").innerHTML = formatTime(TIME_LIMIT) ;
   }
   document.getElementById("start").disabled = true;
 }

 function requestWorkout(){
   var allScelto;
   var reqURI = "apiDb.php/";
   var divNomeWorkout = document.getElementById("nomeWorkout");
   divNomeWorkout.classList.add("workoutName");
   if(tipoAll.value == "Random"){
     var sceltaAll = ["AMRAP","EMOM","SCHEDA"];
     allScelto = sceltaAll[(Math.floor(Math.random() * (3 - 1+1) + 1)) - 1];
     tipoAll.value=allScelto;
     reqURI += generateURI(allScelto,reqURI);
     if(allScelto == "SCHEDA"){
       divNomeWorkout.innerHTML = allScelto;
       document.getElementById("selezioneMinuti").style.display = "none";
     }
     else{
       divNomeWorkout.innerHTML = allScelto;
       document.getElementById("selezioneMinuti").style.display = "block";
     }
   }
   else{
     reqURI += generateURI(tipoAll.value,reqURI);
     if(tipoAll.value == "SCHEDA"){
       divNomeWorkout.innerHTML = tipoAll.value;
     }
     else{
       document.getElementById("selezioneMinuti").style.display = "block";
       divNomeWorkout.innerHTML = tipoAll.value;
     }
    }
    sessionStorage.setItem("allenamento",tipoAll.value);
   //Gestione casistiche random
   document.getElementById("start").disabled = false;
   document.getElementById("displayEsercizi").innerHTML = " ";
   var ajax = new XMLHttpRequest();
   try{
     ajax.onreadystatechange = function(){
       if(ajax.readyState == 4){
         console.log(ajax.responseText);
         console.log(reqURI);
         var esercizi = JSON.parse(ajax.responseText);
         displayWorkout(esercizi);
       }
     };
     ajax.open("GET",reqURI,true);
     ajax.send(null);
   }
   catch(e){
     console.log(e);
   }
 }

 function calculateEmomIntervals(){ //CALCOLO QUI IL TEMPO PER L'EMOM
   var numEsercizi;
   var mux;
   var tempo = document.getElementById("tempo").value;
   if(tempo == 0){
     numEsercizi = Math.floor(Math.random() * (10 - 2+1) + 2);
     mux = Math.floor(Math.random()*(6-2+1)+2);
     TIME_LIMIT = (numEsercizi*mux)*60;
    document.getElementById("base-timer-label").innerHTML = formatTime(TIME_LIMIT);
   }
   else{
     TIME_LIMIT = tempo*60;
     do{
       mux = Math.floor(Math.random()*(6-2+1)+2);
     }while(tempo % mux == 0);
     numEsercizi = Math.floor(tempo/mux);
   }
   return numEsercizi;
   /*var intervallo;
   if(tempo == 0){
     var rounds;
     intervallo = Math.floor(Math.random() * (5 - 2+1) + 2);
     rounds = Math.floor(Math.random()* ((Math.ceil(60/intervallo)) - intervallo+1) + intervallo);
     TIME_LIMIT = (rounds*intervallo) * 60;
     document.getElementById("base-timer-label").innerHTML = formatTime(TIME_LIMIT);
   }
   else{
     intervallo = Math.floor(Math.random()* (5 - 2+1)+2);
     TIME_LIMIT = tempo*60;
   }*/
 }

 function generateURI(allScelto,reqURI){
   reqURI = allScelto;
   switch(allScelto){
     case "AMRAP":
     if(timer.style.display == "none")
     {
       timer.style.display = "block"
     }
     setMinuteOnTimer();
      reqURI += "/"+ Number(document.getElementById("pesiSiNo").checked);
      break;
     case "EMOM":
     if(timer.style.display == "none")
     {
       timer.style.display = "block";
     }
      reqURI += "/"+ Number(document.getElementById("pesiSiNo").checked) + "/" + calculateEmomIntervals();
      break;
     case "SCHEDA":
     timer.style.display = "none";
     //URI: apiDb.php/SCHEDA/pesi/n°Esercizi
     reqURI += "/" + Number(document.getElementById("pesiSiNo").checked) + "/" + Math.floor(Math.random() * (10 - 5+1) + 5);
     break;
   }
   return reqURI;
 }

 function displayWorkout(esercizi){
   var spazioEsercizi = document.getElementById("displayEsercizi");
   spazioEsercizi.style.display = "block";
   var numRep;
   if(tipoAll.value != "SCHEDA"){
     for(var i=0;i<esercizi.length;i++){
       var listaEsercizi = document.createElement("div");
       var Esercizio = document.createElement("div");
       var repsEsercizio = document.createElement("div");
       listaEsercizi.id = "listaEsercizi";
       listaEsercizi.classList.add("flex-container");
       //listaEsercizi.classList.add("justify-content-around");
       //listaEsercizi.classList.add("p-2");
       //Randomizzo il numero di ripetizioni dell'esercizio in un intervallo tra MaxRep e MinRep inclusi
       numRep = Math.floor(Math.random() * (esercizi[i].MaxRep - esercizi[i].MinRep + 1) + esercizi[i].MinRep);
       Esercizio.innerHTML = esercizi[i].Nome;
       Esercizio.classList.add("item");
       repsEsercizio.innerHTML = numRep;
       repsEsercizio.classList.add("item");
       esercizi[i].reps = numRep; //Aggiungo il numero di rep appena scelte. Serve per salvarle nel sessionStorage
       listaEsercizi.appendChild(Esercizio);
       listaEsercizi.appendChild(repsEsercizio);
       spazioEsercizi.appendChild(listaEsercizi);
     }
   }
   else{
     for(var i=0;i<esercizi.length;i++){
       var listaEsercizi = document.createElement("div");
       var Esercizio = document.createElement("div");
       var repsEsercizio = document.createElement("div");
       listaEsercizi.id = "listaEsercizi";
       listaEsercizi.classList.add("flex-container");
       //listaEsercizi.classList.add("justify-content-around");
       //listaEsercizi.classList.add("p-2");
       //Randomizzo il numero di ripetizioni dell'esercizio in un intervallo tra MaxRep e MinRep inclusi
       numRep = Math.floor(Math.random() * (15 - 6+1) + 6);
       numSerie = Math.floor(Math.random() * (6 - 2+1)+2);
       Esercizio.innerHTML = esercizi[i].Nome;
       Esercizio.classList.add("item");
       repsEsercizio.innerHTML = numSerie+" x "+numRep;
       repsEsercizio.classList.add("item");
       listaEsercizi.appendChild(Esercizio);
       listaEsercizi.appendChild(repsEsercizio);
       esercizi[i].serie = numSerie; //Aggiungo il numero di serie appena scelte. Serve per salvarle nel sessionStorage
       esercizi[i].reps = numRep; //Aggiungo il numero di rep appena scelte. Serve per salvarle nel sessionStorage
       spazioEsercizi.appendChild(listaEsercizi);
       //spazioEsercizi.appendChild(document.createElement("br"));
     }
   }
   //document.getElementById("displayEsercizi").appendChild(listaEsercizi);
   sessionStorage.setItem("esercizi",JSON.stringify(esercizi));
 }

</script>

<!-- <div id="reservedAreaForm" class="modal">
 Modal content
<div class="modal-content">
  <div class="modal-header">
    <span class="close">&times;</span>  &times è una entità di html e serve per il simbolo della X
    <h2>Area riservata</h2>
  </div>
  <div class="modal-body">
    <span id="loginButton" class="swipeBtn"> Login </span> <span id="registerButton" class="swipeBtn"> Register </span> <br>
    <div id="loginForm">
      <label for="email"> Email: </label> <br>
      <input type="email" id="email" placeholder="mario.rossi@rwg.com"> <br>
      <label for="password"> Password: </label> <br>
      <input type="password" id="password"> <br>
      <button id="login"> Log in </button>
    </div>
    <div id="signinForm" class="invisibles">
      <p class="pwdAdvertiser"> La password deve essere lunga tra gli 8 ed i 15 caratteri. <br> Inoltre
      deve contenere almeno 1 maiuscola,  <br> 1 minuscola, 1 numero <br> ed 1 carattere speciale </p>
      <label for="name"> Nome: </label> <br>
      <input type="text" id="name"> <br>
      <label for="surname"> Cognome: </label> <br>
      <input type="text" id="surname"> <br>
      <label for="email"> Email: </label> <br>
      <input type="email" id="email2validate" placeholder="mario.rossi@rwg.com"> <br>
      <label for="password1"> Password: </label> <br>
      <input type="password" class="password2validate" id="password1"> <br>
      <label for="password2"> Confirm Password: </label> <br>
      <input type="password" class="password2validate" id="password2"> <br>
      <button id="signup"> Sign up </button>
    </div>
  </div>
</div> -->
<!-- The Modal -->
<div class="modal fade" id="loginModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header loginModal-header">
        <h4 class="modal-title">Area riservata</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <div id="pillsTab">
          <!-- Nav pills -->
         <ul class="nav nav-pills" role="tablist">
           <li class="nav-item">
             <a class="nav-link active" data-bs-toggle="pill" href="#loginPill">Login</a>
           </li>
           <li class="nav-item">
             <a class="nav-link" data-bs-toggle="pill" href="#registerPill">Register</a>
           </li>
         </ul>
        </div>
      </div>
      <div class="tab-content">
        <div id="loginPill" class="container tab-pane active"><br>
          <div id="loginForm">
            <label for="email" class="form-label"> Email: </label> <br>
            <input type="email" id="email" placeholder="mario.rossi@rwg.com" class="form-control"> <br>
            <label for="password" class="form-label"> Password: </label> <br>
            <input type="password" id="password" class="form-control"> <br>
            <button id="login" class="btn btn-primary mb-3"> Log in </button>
          </div>
        </div>
        <div id="registerPill" class="container tab-pane fade"><br>
          <div class="row">
            <div class="col-md was-validated">
              <label for="name" class="form-label"> Nome: </label> <br>
              <input type="text" id="name" class="form-control" required> <br>
              <label for="surname" class="form-label"> Cognome: </label> <br>
              <input type="text" id="surname" class="form-control" required> <br>
              <label for="email" class="form-label"> Email: </label> <br>
              <input type="email" id="email2validate" placeholder="mario.rossi@rwg.com" class="form-control" required> <br>
              <label for="password1" class="form-label"> Password:
                <button type="button" class="btn" data-bs-toggle="popover" data-bs-content="La password deve essere lunga tra gli 8 ed i 15 caratteri. Inoltre
                deve contenere almeno 1 maiuscola, 1 minuscola, 1 numero ed 1 carattere speciale">
                  <img src="images/info_icon.png" width="20px" height="20px">
                </button>
              </label> <br>
              <input type="password" class="password2validate form-control" id="password1" required> <br>
              <label for="password2" class="form-label"> Confirm Password: </label> <br>
              <input type="password" class="password2validate form-control" id="password2" required> <br>
              <button id="signup" class="btn btn-primary mb-3"> Sign up </button>
            </div>
          </div>
        </div>
      </div>
</div>

    </div>
  </div>
</div>

</div>

<!--<button id="personal" class="invisibles" data-bs-toggle="modal" data-bs-target="#loginModal"> Area riservata </button> <br> <br> Da mettere in alto a destra  -->
<div id="reservedAreaPanel">
  <a href="paginaPersonale.html" class="invisibles" id="linkProfilo"> </a>
</div>
<div id="pannelloWorkout" class="flex-container container-md mx-auto">
  <div id="nomeWorkout" class="text-center"> </div>
</div>
</div>

<div class="container"> <br>
  <div id="core" class="row">
    <div class="col-md-4 mt-3">
      <div id="pulsanti">
        <div class="row">
          <button id="request" class="rounded-pill controlWorkout mt-5 ms-1 col"> Request workout </button>
          <button id="start" class="rounded-pill controlWorkout mt-5 ms-1 col" disabled> Start workout </button>
        </div>
        <div class="row">
          <button id="stop" class="rounded-pill controlWorkout mt-3 ms-1 col" disabled> Stop workout </button>
          <button id="pause" class=" rounded-pill controlWorkout mt-3 ms-1 col" disabled> Pause workout </button>
        </div>
        <div class="row">
          <button id="resume" class=" rounded-pill controlWorkout mt-3 ms-1 col" disabled> Resume workout </button>
        </div>
      </div>
    </div>
    <div class="col-md-4 mt-3">
      <div id="timer">
        <div id="app"> <!-- spazio riservato al codice del timer || tenere in considerazione di spostare qui -->
            <script src="ExternalJs/timer.js"> </script>
        </div>
      </div>
    </div>
    <div class="col-md-4 mt-3">
      <!--<div class="row">
        <div id="sostituzioni" class="col me-3">
          Per qualsiasi dubbio sugli esercizi da scalare ecco <a href="sostituzioniEsercizi.html"> qui </a> una guida che fa per te
        </div>
    </div>-->
    <br>
      <div id="opzioniAllenamento" class="row"> <!-- Renderlo a scomparsa nel momento in cui inizia l'allenamento -->
        <div class="col me-3">
          Tipo di allenamento
          <div class="select">
            <select id="tipoAllenamento">
              <option value="Random"> Random </option>
              <option value="AMRAP"> AMRAP </option>
              <option value="EMOM"> EMOM </option>
              <option value="SCHEDA"> Scheda </option>
            </select>
          </div>
      </div>
       <br>
        <div class="col me-3">
          Minuti di allenamento
          <div id="selezioneMinuti">
            <div id="tendinaMinuti" class="select">
              <script>
                var i=9;
                var select = document.createElement("select"); //creo un elemento select e lo salvo in una variabile
                var optionDef = document.createElement("option"); //creo un elemento option e lo salvo in una variabile
                select.id="tempo"; //Imposto l'id del tag select
                optionDef.value = 0; //Imposto l'opzione di default a random e so che vale 0
                optionDef.text = "Random";
                select.appendChild(optionDef);
                for(i;i<60;i++){
                  var option = document.createElement("option"); //creo un elemento option e lo salvo in una variabile
                  option.value = i+1; //imposto l'attributo value
                  option.text = option.value; //imposto il testo che va dentro l'elemento option
                  select.appendChild(option);
                }
                document.getElementById("tendinaMinuti").appendChild(select);
                //workoutParameters = [document.getElementById("opzioniAllenamento"),document.getElementById("start")];
              </script>
            </div>
          </div>
      </div> <br>
        <div class="col me-3">
            <div id="tipoEsercizi" class="form-check form-switch">
              <input type="checkbox" id="pesiSiNo" class="form-check-input">
              <label class="form-check-label float-left" for="pesiSiNo">Allenamento con pesistica?</label>
            </div>
        </div> <br>
      </div>
    </div>
  </div> <br>

  <div id="displayEsercizi" class="exercisePanel align-middle container invisibles">
  </div> <br>

  <div id="player" class="ratio ratio-21x9 youtubeItem"> </div> <br> <br>

  <!--<div id="fineAllenamento" class="invisibles">
    Vuoi salvare l'allenamento? <br>
    <button id="saveWorkout"> Salva </button> <span id="cancel">  &times;</span>
  </div> -->
  <div id="fineAllenamento" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header loginModal-header">
          <h4 class="modal-title">Salvataggio</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <h3>Vuoi salvare l'allenamento?</h3>
        </div>
        <div class="modal-footer flex-container">
          <button id="saveWorkout" class="rounded-pill saveButton mx-2"> Salva </button>
        </div>
      </div>
    </div>
  </div>
</div>
<footer id="footer" class="bg-dark container-fluid text-light myFooter col-12">
  <p> DISCLAIMER: Questo sito non garantisce allenamenti miracolosi e/o combinazioni di esercizi perfette.
  È nato per puro divertimento e per colmare carenze di "fantasia" per gli allenamenti di tutti i giorni.
  In breve, allenatevi forte, spingete tanto e divertitevi. In bocca al lupo &#128521;&#128170; </p>
</footer>
<script>
  /* Script per inizializzare gli elementi popover - start */
  var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
  var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
   return new bootstrap.Popover(popoverTriggerEl)
  })
  /* Script per inizializzare gli elementi popover - end */
  loginModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal')); // Recupero il modal
  saveModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('fineAllenamento')); // Recupero il modal
  alerts = document.getElementById("alertSection");
  timer = document.getElementById("timer");
  tipoAll = document.getElementById("tipoAllenamento");
  document.getElementById("player").style.display = "none";
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '360',
      width: '640',
      playerVars:{
        listType: "playlist",
        list: "PLkqz3S84Tw-T2iHDsB1NdA3RM_3bCxYsg",
        enablejsapi: 1,
        origin: "http://localhost:80"
      },
      events: {
        'onReady': onPlayerReady
      }
    });
  }

  function onPlayerReady(event) {
    player.setShuffle(true);
    player.setLoop(true);
  }

// Login popup - start
//var modal = document.getElementById("reservedAreaForm");
var personalArea = document.getElementById("personal");
var span = document.getElementsByClassName("close")[0];
var logBtn = document.getElementById("loginButton");
var regBtn = document.getElementById("registerButton");
var submitLogin = document.getElementById("login");
var submitRegister = document.getElementById("signup");
var panel = document.getElementById("reservedAreaPanel");
var profilo = document.getElementById("linkProfilo");

/*personalArea.onclick = function(){
  modal.style.display = "block";
}

span.onclick = function(){
  modal.style.display = "none";
}

window.onclick = function(event) { //Casistica in cui si clicca fuori dal form ed esso stesso si chiude
  if (event.target == modal && (event.target != logBtn && event.target != regBtn)) {
    modal.style.display = "none";
  }
}

logBtn.addEventListener("click",swipeLogin);
regBtn.addEventListener("click",swipeSignIn);

function swipeLogin(){
  document.getElementById("loginForm").style.display = "block";
  document.getElementById("signinForm").style.display = "none";
}

function swipeSignIn(){
  document.getElementById("signinForm").style.display = "block";
  document.getElementById("loginForm").style.display = "none";
} */

submitLogin.addEventListener("click",requestForLogin);
submitRegister.addEventListener("click",requestForRegister);

function requestForRegister(){ //  apiDb.php/register
  var password = document.getElementsByClassName("password2validate")[0].value;
  var passwordCnf = document.getElementsByClassName("password2validate")[1].value;
  var email = document.getElementById("email2validate").value;
  if(validateCredentials(password,email)){
    if(password != passwordCnf){
      alerts.innerHTML = `
      <div class="alert alert-danger alert-dismissible fade show">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <strong>Attenzione!</strong> Le due password non coincidono.
      </div> `;
      document.getElementsByClassName("password2validate")[0].value = "";
      document.getElementsByClassName("password2validate")[1].value = "";
    }
    else{
      var request = new Object();
      request.nome = document.getElementById("name").value;
      request.cognome = document.getElementById("surname").value;
      request.password = password;
      request.email = email;
      var reqURI = "apiDb.php/register";
      var ajax = new XMLHttpRequest();
      try{
        ajax.onreadystatechange = function(){
          if(ajax.readyState == 4){
            console.log(ajax.responseText);
            var response = JSON.parse(ajax.responseText);
            if(response.success == true){
              alerts.innerHTML = `
              <div class="alert alert-success alert-dismissible fade show">
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                Utente registrato con successo! Ora puoi effettuare il login
              </div> `;
              document.getElementById("name").value = " ";
              document.getElementById("surname").value = " ";
              document.getElementsByClassName("password2validate")[0].value = "";
              document.getElementsByClassName("password2validate")[1].value = "";
              document.getElementById("email2validate").value = "";
              //modal.style.display = "none";
            }
          }
        };
        ajax.open("POST",reqURI,true);
        ajax.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        ajax.send(JSON.stringify(request));
      }
      catch(e){
        console.log(e);
      }
    }
  }
  else if (document.getElementById("name").value == ""){
    alerts.innerHTML = `
    <div class="alert alert-danger alert-dismissible fade show">
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      <strong> Attenzione! </strong> Nome mancante
    </div> `;
  }
  else if (document.getElementById("surname").value == ""){
    alerts.innerHTML = `
    <div class="alert alert-danger alert-dismissible fade show">
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      <strong> Attenzione! </strong> Cognome mancante
    </div> `;
  }
  else{
    alerts.innerHTML = `
    <div class="alert alert-danger alert-dismissible fade show">
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      <strong> Attenzione! </strong> La password e/o la mail sono errate
    </div> `;
    document.getElementsByClassName("password2validate")[0].value = "";
    document.getElementsByClassName("password2validate")[1].value = "";
    document.getElementById("email2validate").value = "";
  }
  loginModal.hide();
}

function requestForLogin(){ // CHIAMATA REST LOGIN: apiDb.php/login
  var request = new Object();
  request.email = document.getElementById("email").value;
  request.password = document.getElementById("password").value;
  var reqURI = "apiDb.php/login";
  var ajax = new XMLHttpRequest();
  try{
    ajax.onreadystatechange = function(){
      if(ajax.readyState == 4){
        console.log(ajax.responseText);
        var response = JSON.parse(ajax.responseText);
        if(response.success == true){
          document.getElementById("personal").style.display = "none";
          document.getElementById("email").value = "";
          document.getElementById("password").value = "";
          //modal.style.display = "none";
          //panel.innerHTML = response.Nome; LINK AREA riservata
          //var modal = bootstrap.Modal.getInstance(document.getElementById('loginModal')); // Recupero il modal
          loginModal.hide();
          profilo.innerHTML = response.Nome;
          profilo.style.display = "block";
          sessionStorage.setItem("userLogged",response.Nome);
          sessionStorage.setItem("userId",response.IdUtente);
        }
        else{
          alerts.innerHTML = `
          <div class="alert alert-danger alert-dismissible fade show">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <strong> Attenzione! </strong> La password e/o la mail sono errate
          </div> `;
          document.getElementById("email").value = "";
          document.getElementById("password").value = "";
        }
      }
    };
    ajax.open("POST",reqURI,true);
    ajax.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    ajax.send(JSON.stringify(request));
  }
  catch(e){
    console.log(e);
  }
  loginModal.hide();
}

function validateCredentials(pwd,email){
  var paswd =  /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/;
  if(pwd.match(paswd) && email.match(/@/)){
    return true;
  }
  else{
    return false;
  }
}
// Login popup - end
//Session - start
  function verifySession(){
    var user = sessionStorage.getItem("userLogged");
    if(user){
      profilo.innerHTML = user;
      personalArea.style.display = "none";
      profilo.style.display = "block";
      return true;
    }
    else{
      personalArea.style.display = "block";
      return false;
    }
  }
//Session - end

//Fine workout - start
function fineWorkout(){
  player.stopVideo();
  if(sessionStorage.getItem("userLogged")){
    //document.getElementById("fineAllenamento").style.display = "block";
    saveModal.show();
  }
}

/*document.getElementById("cancel").onclick = function(){
  document.getElementById("fineAllenamento").style.display = "none";
};*/

function saveWorkout(){ // - apiDb.php/allenamentogenerato
  var request = Object.assign({},JSON.parse(sessionStorage.getItem("esercizi")));
  request.UserId = sessionStorage.getItem("userId");
  request.Tipo = sessionStorage.getItem("allenamento");
  if(tipoAll.value != "SCHEDA"){
    request.Durata = sessionStorage.getItem("durata");
  }
  else{
    request.Durata = diff_minutes(schedaEndTime,schedaStartTime);
  }
  console.log(request);
  var reqURI = "apiDb.php/allenamentogenerato";
  var ajax = new XMLHttpRequest();
  try{
    ajax.onreadystatechange = function(){
      if(ajax.readyState == 4){
        console.log(ajax.responseText);
        var response = JSON.parse(ajax.responseText);
        //document.getElementById("fineAllenamento").style.display = "none"; //ELimina il "modal" contenente il pulsante che salva il workout
        //var modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('fineAllenamento')); // Recupero il modal
        saveModal.hide();
        if(response.allenamentogenerato == true && response.svolgimento == true && response.Esercizio1 == true){
          alerts.innerHTML = `
          <div class="alert alert-success alert-dismissible fade show">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            Allenamento salvato con successo!
          </div> `;
        }
        else{
          alerts.innerHTML = `
          <div class="alert alert-danger alert-dismissible fade show">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <strong> Attenzione! </strong> Salvataggio allenamento fallito
          </div> `;
        }
      }
    };
    ajax.open("POST",reqURI,true);
    ajax.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    ajax.send(JSON.stringify(request));
  }
  catch(e){
    console.log(e);
  }
}

function diff_minutes(dt2, dt1){
  var diff =(dt2.getTime() - dt1.getTime()) / 1000;
  diff /= 60;
  return Math.abs(Math.round(diff));
 }
//Fine workout - end

function stopWorkout(){
  player.stopVideo();
  stopTimer();
  document.getElementById("displayEsercizi").innerHTML = " ";
  document.getElementById("displayEsercizi").style.display = "none";
  document.getElementById("request").disabled= false;
  //document.getElementById("personal").style.display = "block";
  if(verifySession()){
    //document.getElementById("fineAllenamento").style.display = "block";
    //var modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('fineAllenamento')); // Recupero il modal
    saveModal.show();
    if(tipoAll.value == "SCHEDA"){
     schedaEndTime = new Date();
   }
  }
  //verifySession();
}
</script>

</body>
</html>
