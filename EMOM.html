<html>

<head>
<meta charset="utf-8">
<link rel="stylesheet" href="Css/timer.css">
<link rel="stylesheet" href="Css/cssTemporanei.css">
<title> EMOM </title>
</head>

<body>

  <script>

    window.onload = bindEvents;
    TIME_LIMIT = 0;

    function bindEvents(){
      document.getElementById("start").addEventListener("click",startWorkout);
      document.getElementById("tempo").addEventListener("change",setMinuteOnTimer);
      document.getElementById("pauseSiNo").addEventListener("click",setPause);
      document.getElementById("stop").addEventListener("click",stopWorkout);
      document.getElementById("pause").addEventListener("click",pauseWorkout);
    }

    function startWorkout(){
      for(let i = 0; i<workoutParameters.length; i++){
        workoutParameters[i].style.display = "none";
      }
      document.getElementById("stop").style.display="block";
      document.getElementById("pause").style.display="block";
      DZ.player.next();
      document.getElementById("player").style.display = "block";
      DZ.player.play();
      if(document.getElementById("tempo").value == 0)
      {
        TIME_LIMIT = Math.floor(Math.random() * (60 - 10) + 10);
        TIME_LIMIT = TIME_LIMIT * 60;
        document.getElementById("base-timer-label").innerHTML = formatTime(TIME_LIMIT);
        document.getElementById("pannelloWorkout").innerHTML = "EMOM " + formatTime(TIME_LIMIT) + " minuti";
      }
      startTimer();
    }

    function stopWorkout(){
      DZ.player.pause();
      stopTimer();
    }

    function pauseWorkout(){
      var resumeButton = document.getElementById("resume");
      DZ.player.pause();
      clearInterval(timerInterval);
      document.getElementById("base-timer-label").innerHTML = formatTime(timeLeft);
      resumeButton.style.display="Block";
      resumeButton.addEventListener("click",resumeWorkout);
      document.getElementById("pause").style.display="none";
    }

    function resumeWorkout(){
      DZ.player.play();
      document.getElementById("pause").style.display="block";
      document.getElementById("resume").style.display="none";
      startTimer();
    }

    function setMinuteOnTimer(){
      TIME_LIMIT = document.getElementById("tempo").value;
      document.getElementById("checkPause").style.display = "block";
      if(TIME_LIMIT != 0){
        TIME_LIMIT = TIME_LIMIT * 60;
        document.getElementById("base-timer-label").innerHTML = formatTime(TIME_LIMIT) ;
        document.getElementById("pannelloWorkout").innerHTML = "EMOM " + formatTime(TIME_LIMIT) + " minuti";
      }
      /*else{
        //Inserire codice per minutaggio random/richiesta al server di calcolare con ajax
        alert("Allenamento con minuti random");
      }*/
      if(document.getElementById("pauseSiNo").checked){
        document.getElementById("pauseSiNo").checked = false;
        document.getElementById("pannelloWorkout").innerHTML = "EMOM " + formatTime(TIME_LIMIT) + " minuti";
      }
    }

    function setPause(){
      if(document.getElementById("pauseSiNo").checked){
        document.getElementById("pannelloWorkout").innerHTML += " con recupero";
      }
      else if (!document.getElementById("pauseSiNo").checked) {
        document.getElementById("pannelloWorkout").innerHTML = "EMOM " + formatTime(TIME_LIMIT) + " minuti";
      }
    }


  </script>

  <div id="descrizione">
    <h2> <strong> EMOM </strong> </h2> <br>
    Dall'acronimo "Each Minute On Minute" è un protocollo di allenamento un pò <br>
    più strutturato, inquanto per ogni minuto di allenamento sarà presente 1 esercizio soltanto <br>
    con delle ripetizioni ben stabilite da portare a termine entro il minuto corrente! <br>
    Il tempo restante è dedicato al recupero... dunque è meglio darsi da fare ed essere rapidi!
  </div>

  <div id="timer">
    <div id="app">
      <script src="ExternalJs/timer.js"> </script>
    </div>
    <button id="start"> Start workout </button>
    <button id="stop" class="invisibles"> Stop workout </button>
    <button id="pause" class="invisibles"> Pause workout </button>
    <button id="resume" class="invisibles"> Resume workout </button>
  </div>
  <!-- API DEEZER -->
  <script src="https://e-cdn-files.dzcdn.net/js/min/dz.js"></script> <!-- File col player di DEEZER -->
  <div id="dz-root"> </div> <!-- Div richiesto dalle API di DEEZER -->
  <div id="player"> </div>

  <div id="pannelloWorkout"> </div>
    <div id="opzioniAllenamento">
      <div id="selezioneMinuti">
        Minuti di allenamento :
        <script>
          var i=0;
          var select = document.createElement("select"); //creo un elemento select e lo salvo in una variabile
          var optionDef = document.createElement("option"); //creo un elemento option e lo salvo in una variabile
          select.id="tempo"; //Imposto l'id del tag select
          optionDef.value = 0; //Imposto l'opzione di default a random e so che vale 0
          optionDef.text = "Random";
          select.appendChild(optionDef);
          for(i;i<60;i++){
            var option = document.createElement("option"); //creo un elemento option e lo salvo in una variabile
            option.value = i+1; //imposto l'attributo value
            option.text = option.value; //imposto il testo che va dentro l'elemento option
            select.appendChild(option);
          }
          document.getElementById("selezioneMinuti").appendChild(select);
          workoutParameters = [document.getElementById("opzioniAllenamento"),document.getElementById("start")];
        </script>
      </div> <br>
      <div id="checkPause" class="invisibles">
        Minuti di recupero?
        <input type="checkBox" id="pauseSiNo">
      </div> <br>
      <div id="tipoEsercizi">
        Disponi di manubri/pesi?
        <input type="checkbox" id="pesiSiNo">
      </div>
  </div>
  <script>
    document.getElementById("player").style.display = "none";
    DZ.init({
      appId  : '539622',
      channelUrl : 'http://developers.deezer.com/examples/channel.php', //Vedere quale tenere
      //channelUrl : 'http://localhost/Prog3/RandomWorkout/deezerChannel.html',
      player: {
        container: 'player',
        cover : true,
        layout : 'dark',
        width : 650,
        height : 300,
        onload : playerLoaded
      }
    });

    function playerLoaded(){
      DZ.player.playPlaylist(8424675842);
      DZ.player.setShuffle(true);
    }
  </script>
</body>

</html>
